# è·³è¡¨é¡¹ç›®æµ‹è¯•å•å…ƒæ„å»ºæ•™ç¨‹

## ğŸ“š ç›®å½•
1. [é¡¹ç›®ç»“æ„æ¦‚è§ˆ](#é¡¹ç›®ç»“æ„æ¦‚è§ˆ)
2. [ç¼–è¯‘ç³»ç»Ÿè¯´æ˜](#ç¼–è¯‘ç³»ç»Ÿè¯´æ˜)
3. [å¦‚ä½•ç¼–å†™æµ‹è¯•å•å…ƒ](#å¦‚ä½•ç¼–å†™æµ‹è¯•å•å…ƒ)
4. [è¿è¡Œæµ‹è¯•](#è¿è¡Œæµ‹è¯•)
5. [æ€§èƒ½æµ‹è¯•æœ€ä½³å®è·µ](#æ€§èƒ½æµ‹è¯•æœ€ä½³å®è·µ)

---

## é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
Skiplist-CPP-master/
â”œâ”€â”€ skiplist.h              # åŸç‰ˆè·³è¡¨å®ç°
â”œâ”€â”€ skiplist_optimized.h    # ä¼˜åŒ–ç‰ˆè·³è¡¨å®ç°
â”œâ”€â”€ main.cpp                # åŸºç¡€ç¤ºä¾‹ç¨‹åº
â”œâ”€â”€ test_optimized.cpp      # ä¼˜åŒ–ç‰ˆæµ‹è¯•ç¨‹åº
â”œâ”€â”€ makefile                # ç¼–è¯‘é…ç½®æ–‡ä»¶
â”œâ”€â”€ bin/                    # å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ main
â”‚   â””â”€â”€ test_optimized
â””â”€â”€ store/                  # æ•°æ®æŒä¹…åŒ–ç›®å½•
```

---

## ç¼–è¯‘ç³»ç»Ÿè¯´æ˜

### Makefile é…ç½®

é¡¹ç›®ä½¿ç”¨ `makefile` ç®¡ç†ç¼–è¯‘è¿‡ç¨‹ï¼Œæ”¯æŒä»¥ä¸‹ç¼–è¯‘ç›®æ ‡ï¼š

```makefile
# ç¼–è¯‘åŸç‰ˆè·³è¡¨ç¤ºä¾‹
make skiplist

# ç¼–è¯‘ä¼˜åŒ–ç‰ˆæµ‹è¯•ç¨‹åº
make test_optimized

# ç¼–è¯‘æ‰€æœ‰ç›®æ ‡
make all

# æ¸…ç†ç¼–è¯‘äº§ç‰©
make clean
```

### ç¼–è¯‘å‚æ•°è¯´æ˜

- **ç¼–è¯‘å™¨**: `g++`
- **C++ æ ‡å‡†**: 
  - åŸç‰ˆ: `--std=c++11`
  - ä¼˜åŒ–ç‰ˆ: `--std=c++17`
- **çº¿ç¨‹æ”¯æŒ**: `-pthread` (æ”¯æŒå¤šçº¿ç¨‹æµ‹è¯•)
- **è¾“å‡ºç›®å½•**: `./bin/`

---

## å¦‚ä½•ç¼–å†™æµ‹è¯•å•å…ƒ

### 1ï¸âƒ£ åˆ›å»ºæ–°çš„æµ‹è¯•æ–‡ä»¶

å‡è®¾ä½ è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯•æ–‡ä»¶ `my_test.cpp`ï¼š

```cpp
#include <iostream>
#include <chrono>
#include <thread>
#include <vector>
#include "skiplist.h"

// å®šä¹‰æµ‹è¯•å‚æ•°
#define TEST_COUNT 10000
#define NUM_THREADS 4

// æµ‹è¯•å‡½æ•°ç¤ºä¾‹
void test_insert_performance() {
    std::cout << "========== æ’å…¥æ€§èƒ½æµ‹è¯• ==========" << std::endl;
    
    SkipList<int, std::string> skipList(18);
    
    auto start = std::chrono::high_resolution_clock::now();
    
    for (int i = 0; i < TEST_COUNT; i++) {
        skipList.insert_element(i, "value_" + std::to_string(i));
    }
    
    auto end = std::chrono::high_resolution_clock::now();
    auto duration = std::chrono::duration_cast<std::chrono::milliseconds>(end - start);
    
    std::cout << "æ’å…¥ " << TEST_COUNT << " ä¸ªå…ƒç´ è€—æ—¶: " 
              << duration.count() << " ms" << std::endl;
    std::cout << "QPS: " << (TEST_COUNT * 1000.0 / duration.count()) << std::endl;
}

int main() {
    test_insert_performance();
    return 0;
}
```

### 2ï¸âƒ£ åœ¨ Makefile ä¸­æ·»åŠ ç¼–è¯‘è§„åˆ™

åœ¨ `makefile` ä¸­æ·»åŠ æ–°çš„ç¼–è¯‘ç›®æ ‡ï¼š

```makefile
# ç¼–è¯‘è‡ªå®šä¹‰æµ‹è¯•
my_test: my_test.o
	$(CC) -o ./bin/my_test my_test.o --std=c++17 -pthread
	rm -f ./*.o
```

### 3ï¸âƒ£ æµ‹è¯•å•å…ƒçš„åŸºæœ¬ç»“æ„

ä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•å•å…ƒåº”è¯¥åŒ…å«ï¼š

#### âœ… åŠŸèƒ½æµ‹è¯•

```cpp
void test_basic_operations() {
    std::cout << "\n========== åŸºæœ¬æ“ä½œæµ‹è¯• ==========" << std::endl;
    SkipList<int, std::string> skipList(6);
    
    // 1. æ’å…¥æµ‹è¯•
    skipList.insert_element(1, "one");
    skipList.insert_element(3, "three");
    skipList.insert_element(7, "seven");
    
    // 2. æŸ¥è¯¢æµ‹è¯•
    skipList.search_element(3);  // åº”è¯¥æ‰¾åˆ°
    skipList.search_element(5);  // åº”è¯¥æ‰¾ä¸åˆ°
    
    // 3. åˆ é™¤æµ‹è¯•
    skipList.delete_element(3);
    
    // 4. éªŒè¯ç»“æœ
    std::cout << "è·³è¡¨å¤§å°: " << skipList.size() << std::endl;
    skipList.display_list();
}
```

#### âš¡ æ€§èƒ½æµ‹è¯•

```cpp
void test_performance() {
    std::cout << "\n========== æ€§èƒ½æµ‹è¯• ==========" << std::endl;
    SkipList<int, std::string> skipList(18);
    
    // è®¡æ—¶å¼€å§‹
    auto start = std::chrono::high_resolution_clock::now();
    
    // æ‰§è¡Œæ“ä½œ
    for (int i = 0; i < TEST_COUNT; i++) {
        skipList.insert_element(i, "value_" + std::to_string(i));
    }
    
    // è®¡æ—¶ç»“æŸ
    auto end = std::chrono::high_resolution_clock::now();
    auto duration = std::chrono::duration_cast<std::chrono::milliseconds>(end - start);
    
    // è¾“å‡ºç»“æœ
    std::cout << "è€—æ—¶: " << duration.count() << " ms" << std::endl;
    std::cout << "QPS: " << (TEST_COUNT * 1000.0 / duration.count()) << std::endl;
}
```

#### ğŸ”€ å¤šçº¿ç¨‹æµ‹è¯•

```cpp
// çº¿ç¨‹å·¥ä½œå‡½æ•°
void thread_worker(SkipList<int, std::string>* skipList, int thread_id, int count) {
    int start = thread_id * count;
    for (int i = 0; i < count; i++) {
        skipList->insert_element(start + i, "value_" + std::to_string(start + i));
    }
}

void test_concurrent_insert() {
    std::cout << "\n========== å¤šçº¿ç¨‹æ’å…¥æµ‹è¯• ==========" << std::endl;
    SkipList<int, std::string> skipList(18);
    
    std::vector<std::thread> threads;
    int count_per_thread = TEST_COUNT / NUM_THREADS;
    
    auto start = std::chrono::high_resolution_clock::now();
    
    // åˆ›å»ºçº¿ç¨‹
    for (int i = 0; i < NUM_THREADS; i++) {
        threads.emplace_back(thread_worker, &skipList, i, count_per_thread);
    }
    
    // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
    for (auto& t : threads) {
        t.join();
    }
    
    auto end = std::chrono::high_resolution_clock::now();
    auto duration = std::chrono::duration_cast<std::chrono::milliseconds>(end - start);
    
    std::cout << "ä½¿ç”¨ " << NUM_THREADS << " ä¸ªçº¿ç¨‹æ’å…¥ " << TEST_COUNT << " ä¸ªå…ƒç´ " << std::endl;
    std::cout << "æ€»è€—æ—¶: " << duration.count() << " ms" << std::endl;
    std::cout << "QPS: " << (TEST_COUNT * 1000.0 / duration.count()) << std::endl;
}
```

---

## è¿è¡Œæµ‹è¯•

### æ­¥éª¤ 1: ç¼–è¯‘æµ‹è¯•ç¨‹åº

```bash
# ç¼–è¯‘åŸç‰ˆè·³è¡¨ç¤ºä¾‹
make skiplist

# ç¼–è¯‘ä¼˜åŒ–ç‰ˆæµ‹è¯•
make test_optimized

# æˆ–è€…ç¼–è¯‘æ‰€æœ‰
make all
```

### æ­¥éª¤ 2: è¿è¡Œæµ‹è¯•

```bash
# è¿è¡ŒåŸç‰ˆç¤ºä¾‹
./bin/main

# è¿è¡Œä¼˜åŒ–ç‰ˆæµ‹è¯•
./bin/test_optimized
```

### æ­¥éª¤ 3: æŸ¥çœ‹æµ‹è¯•ç»“æœ

æµ‹è¯•ç¨‹åºä¼šè¾“å‡ºï¼š
- âœ… åŠŸèƒ½æµ‹è¯•ç»“æœï¼ˆæ’å…¥ã€æŸ¥è¯¢ã€åˆ é™¤æ˜¯å¦æ­£å¸¸ï¼‰
- â±ï¸ æ€§èƒ½æŒ‡æ ‡ï¼ˆè€—æ—¶ã€QPSï¼‰
- ğŸ“Š å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆå¦‚æœä½¿ç”¨ä¼˜åŒ–ç‰ˆï¼‰
- ğŸ“ˆ è·³è¡¨ç»“æ„å±•ç¤º

### ç¤ºä¾‹è¾“å‡º

```
========== åŸºæœ¬åŠŸèƒ½æµ‹è¯• ==========

--- æ’å…¥æµ‹è¯• ---
è·³è¡¨å¤§å°: 6

--- æŸ¥è¯¢æµ‹è¯• ---
Found key: 9, value: nine
Not Found Key: 18

--- åˆ é™¤æµ‹è¯• ---
åˆ é™¤åè·³è¡¨å¤§å°: 4

========== æµ‹è¯•åŸç‰ˆè·³è¡¨ ==========
æ’å…¥ 10000 ä¸ªå…ƒç´ è€—æ—¶: 45 ms
QPS: 222222.22

========== ä¼˜åŒ–ç‰ˆè·³è¡¨å¤šçº¿ç¨‹æ’å…¥æµ‹è¯• ==========
ä½¿ç”¨ 8 ä¸ªçº¿ç¨‹æ’å…¥ 10000 ä¸ªå…ƒç´ 
æ€»è€—æ—¶: 12 ms
QPS: 833333.33
å®é™…å…ƒç´ æ•°é‡: 10000
```

---

## æ€§èƒ½æµ‹è¯•æœ€ä½³å®è·µ

### ğŸ“ æµ‹è¯•è§„æ¨¡å»ºè®®

| æµ‹è¯•ç±»å‹ | å»ºè®®æ•°æ®é‡ | è¯´æ˜ |
|---------|-----------|------|
| åŠŸèƒ½æµ‹è¯• | 10-100 | éªŒè¯æ­£ç¡®æ€§ |
| å•çº¿ç¨‹æ€§èƒ½ | 10,000-100,000 | åŸºå‡†æ€§èƒ½ |
| å¤šçº¿ç¨‹æ€§èƒ½ | 100,000-1,000,000 | å¹¶å‘èƒ½åŠ› |
| å‹åŠ›æµ‹è¯• | 1,000,000+ | æé™æµ‹è¯• |

### ğŸ¯ å…³é”®æ€§èƒ½æŒ‡æ ‡

1. **QPS (Queries Per Second)**: æ¯ç§’æ“ä½œæ•°
   ```cpp
   QPS = æ€»æ“ä½œæ•° / (è€—æ—¶æ¯«ç§’æ•° / 1000)
   ```

2. **å»¶è¿Ÿ (Latency)**: å•æ¬¡æ“ä½œè€—æ—¶
   ```cpp
   å¹³å‡å»¶è¿Ÿ = æ€»è€—æ—¶ / æ€»æ“ä½œæ•°
   ```

3. **ååé‡ (Throughput)**: å•ä½æ—¶é—´å¤„ç†çš„æ•°æ®é‡

### âš™ï¸ æµ‹è¯•å‚æ•°è°ƒä¼˜

```cpp
// è·³è¡¨æœ€å¤§å±‚æ•°ï¼ˆå½±å“æŸ¥è¯¢æ€§èƒ½ï¼‰
// å»ºè®®: log2(é¢„æœŸå…ƒç´ æ•°é‡)
SkipList<int, std::string> skipList(18);  // é€‚åˆ 2^18 = 262,144 ä¸ªå…ƒç´ 

// çº¿ç¨‹æ•°é‡ï¼ˆå½±å“å¹¶å‘æ€§èƒ½ï¼‰
// å»ºè®®: CPU æ ¸å¿ƒæ•°çš„ 1-2 å€
#define NUM_THREADS 8

// æµ‹è¯•æ•°æ®é‡
#define TEST_COUNT 100000
```

### ğŸ” è°ƒè¯•æŠ€å·§

1. **æ˜¾ç¤ºè·³è¡¨ç»“æ„**
   ```cpp
   skipList.display_list();  // æŸ¥çœ‹è·³è¡¨å†…éƒ¨ç»“æ„
   ```

2. **æ£€æŸ¥å…ƒç´ æ•°é‡**
   ```cpp
   std::cout << "è·³è¡¨å¤§å°: " << skipList.size() << std::endl;
   ```

3. **å†…å­˜æ± ç»Ÿè®¡ï¼ˆä¼˜åŒ–ç‰ˆï¼‰**
   ```cpp
   skipList.print_memory_pool_stats();  // æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
   ```

### ğŸ“Š å¯¹æ¯”æµ‹è¯•æ¨¡æ¿

```cpp
void compare_performance() {
    const int TEST_SIZE = 50000;
    
    // æµ‹è¯•åŸç‰ˆ
    SkipList<int, std::string> original(18);
    auto start1 = std::chrono::high_resolution_clock::now();
    for (int i = 0; i < TEST_SIZE; i++) {
        original.insert_element(i, "value");
    }
    auto end1 = std::chrono::high_resolution_clock::now();
    auto duration1 = std::chrono::duration_cast<std::chrono::milliseconds>(end1 - start1);
    
    // æµ‹è¯•ä¼˜åŒ–ç‰ˆ
    SkipListOptimized<int, std::string> optimized(18, 16);
    auto start2 = std::chrono::high_resolution_clock::now();
    for (int i = 0; i < TEST_SIZE; i++) {
        optimized.insert_element(i, "value");
    }
    auto end2 = std::chrono::high_resolution_clock::now();
    auto duration2 = std::chrono::duration_cast<std::chrono::milliseconds>(end2 - start2);
    
    // è¾“å‡ºå¯¹æ¯”ç»“æœ
    std::cout << "åŸç‰ˆè€—æ—¶: " << duration1.count() << " ms" << std::endl;
    std::cout << "ä¼˜åŒ–ç‰ˆè€—æ—¶: " << duration2.count() << " ms" << std::endl;
    std::cout << "æ€§èƒ½æå‡: " << (duration1.count() * 100.0 / duration2.count() - 100) << "%" << std::endl;
}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ç¤ºä¾‹

åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•æ–‡ä»¶ `quick_test.cpp`ï¼š

```cpp
#include <iostream>
#include "skiplist.h"

int main() {
    // åˆ›å»ºè·³è¡¨
    SkipList<int, std::string> skipList(6);
    
    // æ’å…¥æ•°æ®
    skipList.insert_element(1, "ä¸€");
    skipList.insert_element(2, "äºŒ");
    skipList.insert_element(3, "ä¸‰");
    
    // æŸ¥è¯¢æ•°æ®
    skipList.search_element(2);
    
    // æ˜¾ç¤ºç»“æ„
    skipList.display_list();
    
    // è¾“å‡ºå¤§å°
    std::cout << "è·³è¡¨å¤§å°: " << skipList.size() << std::endl;
    
    return 0;
}
```

åœ¨ `makefile` ä¸­æ·»åŠ ï¼š

```makefile
quick_test: quick_test.o
	$(CC) -o ./bin/quick_test quick_test.o --std=c++11 -pthread
	rm -f ./*.o
```

ç¼–è¯‘å¹¶è¿è¡Œï¼š

```bash
make quick_test
./bin/quick_test
```

---

## ğŸ“ æ€»ç»“

æ„å»ºæµ‹è¯•å•å…ƒçš„å…³é”®æ­¥éª¤ï¼š

1. âœï¸ **ç¼–å†™æµ‹è¯•ä»£ç ** - åŒ…å«åŠŸèƒ½æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•
2. ğŸ”§ **é…ç½® Makefile** - æ·»åŠ ç¼–è¯‘è§„åˆ™
3. ğŸ—ï¸ **ç¼–è¯‘ç¨‹åº** - ä½¿ç”¨ `make` å‘½ä»¤
4. â–¶ï¸ **è¿è¡Œæµ‹è¯•** - æ‰§è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶
5. ğŸ“Š **åˆ†æç»“æœ** - æŸ¥çœ‹è¾“å‡ºçš„æ€§èƒ½æŒ‡æ ‡

è®°ä½ï¼šå¥½çš„æµ‹è¯•åº”è¯¥è¦†ç›–åŸºæœ¬åŠŸèƒ½ã€è¾¹ç•Œæƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡ï¼

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `main.cpp` - åŸºç¡€ç¤ºä¾‹
- `test_optimized.cpp` - å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
- `makefile` - ç¼–è¯‘é…ç½®
- `skiplist.h` - è·³è¡¨å®ç°

æœ‰é—®é¢˜ï¼ŸæŸ¥çœ‹ç°æœ‰çš„æµ‹è¯•æ–‡ä»¶ä½œä¸ºå‚è€ƒï¼

