# é˜¶æ®µ 3ï¼šå¤šå±‚è·³è¡¨å®ç° ğŸ¯

## å­¦ä¹ ç›®æ ‡
- å®ç°çœŸæ­£çš„å¤šå±‚è·³è¡¨ï¼ˆåŠ¨æ€å±‚æ•°ï¼‰
- ç†è§£éšæœºå±‚æ•°ç”Ÿæˆç®—æ³•
- å®ç°å®Œæ•´çš„æ’å…¥ã€æŸ¥æ‰¾ã€åˆ é™¤æ“ä½œ
- è¾¾åˆ° O(log n) çš„æ—¶é—´å¤æ‚åº¦

---

## 1. ä»åŒå±‚åˆ°å¤šå±‚

### ä¸ºä»€ä¹ˆéœ€è¦å¤šå±‚ï¼Ÿ

åœ¨é˜¶æ®µ 2 ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†åŒå±‚è·³è¡¨ã€‚ä½†æ˜¯ï¼š
- å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼ˆå¦‚ 100 ä¸‡æ¡ï¼‰ï¼Œ2 å±‚ä¸å¤Ÿç”¨
- éœ€è¦åŠ¨æ€è°ƒæ•´å±‚æ•°ä»¥é€‚åº”æ•°æ®è§„æ¨¡

**ç†æƒ³çš„è·³è¡¨ç»“æ„**ï¼š

```
Level 3:  [1] --------------------------------> [100] -> NULL
           |                                      |
Level 2:  [1] ---------> [25] ---------> [75] -> [100] -> NULL
           |              |               |        |
Level 1:  [1] -> [10] -> [25] -> [50] -> [75] -> [100] -> NULL
           |      |       |       |       |        |
Level 0:  [1]->[5]->[10]->[20]->[25]...[75]->[90]->[100] -> NULL
```

**å±‚æ•°è§„å¾‹**ï¼š
- Level 0ï¼ˆæ•°æ®å±‚ï¼‰ï¼šæ‰€æœ‰å…ƒç´ 
- Level 1ï¼šçº¦ 50% çš„å…ƒç´ 
- Level 2ï¼šçº¦ 25% çš„å…ƒç´ 
- Level 3ï¼šçº¦ 12.5% çš„å…ƒç´ 
- ...

---

## 2. æ•°æ®ç»“æ„é‡æ–°è®¾è®¡

### èŠ‚ç‚¹ç»“æ„ï¼ˆä½¿ç”¨æŒ‡é’ˆæ•°ç»„ï¼‰

ä¹‹å‰æˆ‘ä»¬ç”¨ `next` å’Œ `down` ä¸¤ä¸ªæŒ‡é’ˆã€‚ç°åœ¨æ”¹ç”¨**æŒ‡é’ˆæ•°ç»„**ï¼š

```cpp
template<typename K, typename V>
class Node {
public:
    K key;
    V value;
    Node<K, V>** forward;  // æŒ‡é’ˆæ•°ç»„ï¼Œforward[i] æŒ‡å‘ç¬¬ i å±‚çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    int node_level;        // èŠ‚ç‚¹çš„å±‚æ•°
    
    Node(K k, V v, int level) {
        key = k;
        value = v;
        node_level = level;
        
        // åˆ†é…æŒ‡é’ˆæ•°ç»„ï¼ˆlevel+1 ä¸ªæŒ‡é’ˆï¼‰
        forward = new Node<K, V>*[level + 1];
        
        // åˆå§‹åŒ–ä¸º nullptr
        for (int i = 0; i <= level; i++) {
            forward[i] = nullptr;
        }
    }
    
    ~Node() {
        delete[] forward;  // é‡Šæ”¾æŒ‡é’ˆæ•°ç»„
    }
};
```

**ä¸ºä»€ä¹ˆç”¨æŒ‡é’ˆæ•°ç»„ï¼Ÿ**

```
èŠ‚ç‚¹ [5] åœ¨ 3 å±‚ï¼š
forward[0] -> æŒ‡å‘ Level 0 çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
forward[1] -> æŒ‡å‘ Level 1 çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
forward[2] -> æŒ‡å‘ Level 2 çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
```

### è·³è¡¨ç±»ç»“æ„

```cpp
template<typename K, typename V>
class SkipList {
private:
    int max_level;           // æœ€å¤§å±‚æ•°ï¼ˆå¦‚ 16ï¼‰
    int current_level;       // å½“å‰è·³è¡¨çš„å±‚æ•°
    Node<K, V>* header;      // å¤´èŠ‚ç‚¹ï¼ˆå“¨å…µèŠ‚ç‚¹ï¼‰
    int element_count;       // å…ƒç´ ä¸ªæ•°
    
public:
    SkipList(int max_lvl);
    ~SkipList();
    
    int get_random_level();              // ç”Ÿæˆéšæœºå±‚æ•°
    void insert(K key, V value);         // æ’å…¥
    bool search(K key);                  // æŸ¥æ‰¾
    void remove(K key);                  // åˆ é™¤
    void display();                      // æ˜¾ç¤º
    int size();                          // è·å–å¤§å°
};
```

---

## 3. éšæœºå±‚æ•°ç”Ÿæˆç®—æ³•

### æ ¸å¿ƒæ€æƒ³

æ¯ä¸ªèŠ‚ç‚¹çš„å±‚æ•°æ˜¯**éšæœº**çš„ï¼Œä½†éµå¾ªæ¦‚ç‡åˆ†å¸ƒï¼š
- 50% çš„èŠ‚ç‚¹åªåœ¨ Level 0
- 25% çš„èŠ‚ç‚¹åœ¨ Level 0 å’Œ Level 1
- 12.5% çš„èŠ‚ç‚¹åœ¨ Level 0ã€Level 1 å’Œ Level 2
- ...

### ç®—æ³•å®ç°

```cpp
int get_random_level() {
    int level = 0;
    
    // æ¯æ¬¡æœ‰ 50% çš„æ¦‚ç‡å¢åŠ ä¸€å±‚
    while (rand() % 2 && level < max_level) {
        level++;
    }
    
    return level;
}
```

**ç¤ºä¾‹**ï¼š
```
rand() % 2 = 1 (ç»§ç»­) -> level = 1
rand() % 2 = 1 (ç»§ç»­) -> level = 2
rand() % 2 = 0 (åœæ­¢) -> è¿”å› level = 2
```

---

## 4. æ ¸å¿ƒæ“ä½œå®ç°

### 4.1 æ’å…¥æ“ä½œ

**ç®—æ³•æ­¥éª¤**ï¼š

1. ä»æœ€é«˜å±‚å¼€å§‹ï¼Œæ‰¾åˆ°æ¯ä¸€å±‚çš„æ’å…¥ä½ç½®
2. è®°å½•æ¯ä¸€å±‚çš„å‰é©±èŠ‚ç‚¹åˆ° `update` æ•°ç»„
3. ç”Ÿæˆéšæœºå±‚æ•°
4. åˆ›å»ºæ–°èŠ‚ç‚¹å¹¶æ’å…¥åˆ°å„å±‚

**å›¾è§£**ï¼š

```
æ’å…¥ key=17 åˆ°è·³è¡¨ï¼š

åˆå§‹çŠ¶æ€ï¼š
Level 2: [H] ---------> [10] ---------> [30] -> NULL
          |              |               |
Level 1: [H] -> [5] -> [10] -> [20] -> [30] -> NULL
          |      |      |       |       |
Level 0: [H]->[3]->[5]->[10]->[15]->[20]->[30] -> NULL

æ­¥éª¤1ï¼šä» Level 2 å¼€å§‹å‘ä¸‹æŸ¥æ‰¾ï¼Œè®°å½• update æ•°ç»„
update[2] = [10]  (Level 2: 10 < 17 < 30)
update[1] = [10]  (Level 1: 10 < 17 < 20)
update[0] = [15]  (Level 0: 15 < 17 < 20)

æ­¥éª¤2ï¼šç”Ÿæˆéšæœºå±‚æ•°ï¼Œå‡è®¾ level = 1

æ­¥éª¤3ï¼šåˆ›å»ºæ–°èŠ‚ç‚¹å¹¶æ’å…¥
Level 1: [H] -> [5] -> [10] -> [17] -> [20] -> [30] -> NULL
          |      |      |       |       |       |
Level 0: [H]->[3]->[5]->[10]->[15]->[17]->[20]->[30] -> NULL
```

**ä»£ç å®ç°**ï¼š

```cpp
void insert(K key, V value) {
    Node<K, V>* current = header;
    
    // update[i] ä¿å­˜ç¬¬ i å±‚éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹
    Node<K, V>* update[max_level + 1];
    
    // åˆå§‹åŒ– update æ•°ç»„
    for (int i = 0; i <= max_level; i++) {
        update[i] = nullptr;
    }
    
    // ä»æœ€é«˜å±‚å¼€å§‹å‘ä¸‹æŸ¥æ‰¾
    for (int i = current_level; i >= 0; i--) {
        // åœ¨ç¬¬ i å±‚å‘å³ç§»åŠ¨
        while (current->forward[i] != nullptr && 
               current->forward[i]->key < key) {
            current = current->forward[i];
        }
        // è®°å½•ç¬¬ i å±‚çš„å‰é©±èŠ‚ç‚¹
        update[i] = current;
    }
    
    // åˆ°è¾¾ Level 0ï¼Œæ£€æŸ¥ key æ˜¯å¦å·²å­˜åœ¨
    current = current->forward[0];
    
    if (current != nullptr && current->key == key) {
        cout << "key=" << key << " å·²å­˜åœ¨" << endl;
        return;
    }
    
    // ç”Ÿæˆéšæœºå±‚æ•°
    int random_level = get_random_level();
    
    // å¦‚æœéšæœºå±‚æ•°å¤§äºå½“å‰å±‚æ•°ï¼Œæ›´æ–° update æ•°ç»„
    if (random_level > current_level) {
        for (int i = current_level + 1; i <= random_level; i++) {
            update[i] = header;
        }
        current_level = random_level;
    }
    
    // åˆ›å»ºæ–°èŠ‚ç‚¹
    Node<K, V>* new_node = new Node<K, V>(key, value, random_level);
    
    // åœ¨æ¯ä¸€å±‚æ’å…¥æ–°èŠ‚ç‚¹
    for (int i = 0; i <= random_level; i++) {
        new_node->forward[i] = update[i]->forward[i];
        update[i]->forward[i] = new_node;
    }
    
    element_count++;
    cout << "æ’å…¥æˆåŠŸ: key=" << key << ", value=" << value 
         << ", level=" << random_level << endl;
}
```

### 4.2 æŸ¥æ‰¾æ“ä½œ

**ç®—æ³•æ­¥éª¤**ï¼š

1. ä»æœ€é«˜å±‚å¼€å§‹
2. åœ¨å½“å‰å±‚å‘å³ç§»åŠ¨ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ key >= ç›®æ ‡ key
3. ä¸‹é™åˆ°ä¸‹ä¸€å±‚ï¼Œé‡å¤æ­¥éª¤ 2
4. åœ¨ Level 0 æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°

**ä»£ç å®ç°**ï¼š

```cpp
bool search(K key) {
    Node<K, V>* current = header;
    
    // ä»æœ€é«˜å±‚å¼€å§‹å‘ä¸‹æŸ¥æ‰¾
    for (int i = current_level; i >= 0; i--) {
        // åœ¨ç¬¬ i å±‚å‘å³ç§»åŠ¨
        while (current->forward[i] != nullptr && 
               current->forward[i]->key < key) {
            current = current->forward[i];
        }
    }
    
    // åˆ°è¾¾ Level 0
    current = current->forward[0];
    
    // æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°
    if (current != nullptr && current->key == key) {
        cout << "æ‰¾åˆ° key=" << key << ", value=" << current->value << endl;
        return true;
    }
    
    cout << "æœªæ‰¾åˆ° key=" << key << endl;
    return false;
}
```

### 4.3 åˆ é™¤æ“ä½œ

**ç®—æ³•æ­¥éª¤**ï¼š

1. æ‰¾åˆ°æ¯ä¸€å±‚éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ï¼ˆç±»ä¼¼æ’å…¥ï¼‰
2. åœ¨æ¯ä¸€å±‚åˆ é™¤ç›®æ ‡èŠ‚ç‚¹
3. æ›´æ–°è·³è¡¨çš„å½“å‰å±‚æ•°
4. é‡Šæ”¾èŠ‚ç‚¹å†…å­˜

**å›¾è§£**ï¼š

```
åˆ é™¤ key=17ï¼š

åˆ é™¤å‰ï¼š
Level 1: [H] -> [10] -> [17] -> [20] -> NULL
          |      |       |       |
Level 0: [H]->[10]->[15]->[17]->[20] -> NULL

æ­¥éª¤1ï¼šæ‰¾åˆ° update æ•°ç»„
update[1] = [10]
update[0] = [15]

æ­¥éª¤2ï¼šåœ¨æ¯å±‚åˆ é™¤
Level 1: [H] -> [10] --------> [20] -> NULL
          |      |              |
Level 0: [H]->[10]->[15]------>[20] -> NULL

æ­¥éª¤3ï¼šé‡Šæ”¾èŠ‚ç‚¹ [17]
```

**ä»£ç å®ç°**ï¼š

```cpp
void remove(K key) {
    Node<K, V>* current = header;
    Node<K, V>* update[max_level + 1];
    
    // åˆå§‹åŒ– update æ•°ç»„
    for (int i = 0; i <= max_level; i++) {
        update[i] = nullptr;
    }
    
    // ä»æœ€é«˜å±‚å¼€å§‹å‘ä¸‹æŸ¥æ‰¾
    for (int i = current_level; i >= 0; i--) {
        while (current->forward[i] != nullptr && 
               current->forward[i]->key < key) {
            current = current->forward[i];
        }
        update[i] = current;
    }
    
    // åˆ°è¾¾ Level 0
    current = current->forward[0];
    
    // æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°
    if (current == nullptr || current->key != key) {
        cout << "æœªæ‰¾åˆ° key=" << key << endl;
        return;
    }
    
    // åœ¨æ¯ä¸€å±‚åˆ é™¤èŠ‚ç‚¹
    for (int i = 0; i <= current_level; i++) {
        if (update[i]->forward[i] != current) {
            break;
        }
        update[i]->forward[i] = current->forward[i];
    }
    
    // é‡Šæ”¾èŠ‚ç‚¹
    delete current;
    element_count--;
    
    // æ›´æ–°å½“å‰å±‚æ•°ï¼ˆåˆ é™¤ç©ºå±‚ï¼‰
    while (current_level > 0 && 
           header->forward[current_level] == nullptr) {
        current_level--;
    }
    
    cout << "åˆ é™¤æˆåŠŸ: key=" << key << endl;
}
```

### 4.4 æ˜¾ç¤ºæ“ä½œ

```cpp
void display() {
    cout << "\n========== è·³è¡¨ç»“æ„ ==========" << endl;
    
    for (int i = current_level; i >= 0; i--) {
        Node<K, V>* node = header->forward[i];
        cout << "Level " << i << ": ";
        
        while (node != nullptr) {
            cout << "[" << node->key << ":" << node->value << "]";
            if (node->forward[i] != nullptr) {
                cout << " -> ";
            }
            node = node->forward[i];
        }
        cout << " -> NULL" << endl;
    }
    
    cout << "å½“å‰å±‚æ•°: " << current_level << endl;
    cout << "å…ƒç´ ä¸ªæ•°: " << element_count << endl;
    cout << "==============================" << endl;
}
```

---

## 5. å®Œæ•´ä»£ç 

**æ–‡ä»¶å**ï¼š`stage3_multi_level.cpp`

ç”±äºä»£ç è¾ƒé•¿ï¼Œæˆ‘å°†åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­æä¾›å®Œæ•´å®ç°ã€‚

---

## 6. ç¼–è¯‘å’Œè¿è¡Œ

### ç¼–è¯‘

```bash
cd /Users/cjx/Downloads/Skiplist-CPP-master/learning-plan
g++ -std=c++11 -o stage3 stage3_multi_level.cpp
```

### è¿è¡Œ

```bash
./stage3
```

---

## 7. æ—¶é—´å¤æ‚åº¦åˆ†æ

### ç†è®ºåˆ†æ

å‡è®¾æœ‰ n ä¸ªå…ƒç´ ï¼š

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | è¯´æ˜ |
|------|-----------|------|
| æ’å…¥ | O(log n) | å¹³å‡éœ€è¦éå† log n ä¸ªèŠ‚ç‚¹ |
| æŸ¥æ‰¾ | O(log n) | å¹³å‡éœ€è¦éå† log n ä¸ªèŠ‚ç‚¹ |
| åˆ é™¤ | O(log n) | å¹³å‡éœ€è¦éå† log n ä¸ªèŠ‚ç‚¹ |

### ä¸ºä»€ä¹ˆæ˜¯ O(log n)ï¼Ÿ

- æ¯å±‚çº¦æœ‰å‰ä¸€å±‚ 50% çš„èŠ‚ç‚¹
- å¦‚æœæœ‰ n ä¸ªå…ƒç´ ï¼Œéœ€è¦çº¦ logâ‚‚(n) å±‚
- æ¯å±‚å¹³å‡éå† 2 ä¸ªèŠ‚ç‚¹
- æ€»å…±éå†çº¦ 2 Ã— logâ‚‚(n) ä¸ªèŠ‚ç‚¹

**ç¤ºä¾‹**ï¼š
- 1000 ä¸ªå…ƒç´ ï¼šçº¦éœ€è¦ 10 å±‚ï¼Œéå†çº¦ 20 ä¸ªèŠ‚ç‚¹
- 100 ä¸‡ä¸ªå…ƒç´ ï¼šçº¦éœ€è¦ 20 å±‚ï¼Œéå†çº¦ 40 ä¸ªèŠ‚ç‚¹

---

## 8. ç»ƒä¹ é¢˜

### ç»ƒä¹  1ï¼šç»Ÿè®¡å±‚æ•°åˆ†å¸ƒ
ç¼–å†™ä»£ç ç»Ÿè®¡æ¯ä¸€å±‚æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼ŒéªŒè¯æ˜¯å¦ç¬¦åˆ 50% çš„è§„å¾‹ã€‚

### ç»ƒä¹  2ï¼šæ€§èƒ½æµ‹è¯•
æ’å…¥ 10000 ä¸ªéšæœºæ•°ï¼Œæµ‹è¯•æŸ¥æ‰¾ 1000 æ¬¡çš„å¹³å‡æ—¶é—´ã€‚

### ç»ƒä¹  3ï¼šå¯è§†åŒ–ä¼˜åŒ–
æ”¹è¿› `display()` æ–¹æ³•ï¼Œä½¿è¾“å‡ºæ›´ç¾è§‚ï¼Œæ˜¾ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»ã€‚

---

## 9. å¸¸è§é—®é¢˜

### Q1ï¼šä¸ºä»€ä¹ˆè¦ç”¨å¤´èŠ‚ç‚¹ï¼ˆå“¨å…µèŠ‚ç‚¹ï¼‰ï¼Ÿ
Aï¼šç®€åŒ–è¾¹ç•Œæ¡ä»¶å¤„ç†ï¼Œé¿å…ç‰¹æ®Šåˆ¤æ–­ç©ºé“¾è¡¨çš„æƒ…å†µã€‚

### Q2ï¼šæœ€å¤§å±‚æ•°å¦‚ä½•ç¡®å®šï¼Ÿ
Aï¼šé€šå¸¸è®¾ä¸º logâ‚‚(n)ï¼Œå¦‚ 16 æˆ– 32ã€‚å¯¹äº 2Â³Â² ä¸ªå…ƒç´ ï¼Œ32 å±‚è¶³å¤Ÿã€‚

### Q3ï¼šå¦‚æœéšæœºæ•°ä¸å¤Ÿéšæœºä¼šæ€æ ·ï¼Ÿ
Aï¼šå¯èƒ½å¯¼è‡´å±‚æ•°åˆ†å¸ƒä¸å‡ï¼Œå½±å“æ€§èƒ½ã€‚ä½¿ç”¨æ›´å¥½çš„éšæœºæ•°ç”Ÿæˆå™¨å¯ä»¥æ”¹å–„ã€‚

---

## 10. å…³é”®æ”¶è·

é€šè¿‡é˜¶æ®µ 3ï¼Œä½ åº”è¯¥æŒæ¡äº†ï¼š
- âœ… å¤šå±‚è·³è¡¨çš„å®ç°
- âœ… æŒ‡é’ˆæ•°ç»„çš„ä½¿ç”¨
- âœ… éšæœºå±‚æ•°ç”Ÿæˆç®—æ³•
- âœ… O(log n) æ—¶é—´å¤æ‚åº¦çš„å®ç°
- âœ… å®Œæ•´çš„æ’å…¥ã€æŸ¥æ‰¾ã€åˆ é™¤æ“ä½œ

---

## 11. ä¸‹ä¸€æ­¥

åœ¨é˜¶æ®µ 4 ä¸­ï¼Œæˆ‘ä»¬å°†ï¼š
- å°†è·³è¡¨æ”¹é€ ä¸ºæ¨¡æ¿ç±»ï¼ˆå·²ç»æ˜¯æ¨¡æ¿äº†ï¼Œä½†ä¼šè¿›ä¸€æ­¥ä¼˜åŒ–ï¼‰
- é‡æ„ä»£ç ï¼Œæé«˜å¯è¯»æ€§
- æ·»åŠ æ›´å¤šè¾…åŠ©æ–¹æ³•

ğŸ‘‰ ç»§ç»­å­¦ä¹ ï¼š`05-é˜¶æ®µ4-æ¨¡æ¿åŒ–.md`

